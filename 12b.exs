input = """
..?##?.?.??#???#? 3,7
???.##??##???#??.# 1,1,7,1,1,1
?#.??.??#.??#? 1,1,2,2
?????.?#???? 1,2,1,1
??##???.?.???. 6,1,2
#??#.??.?.????.#?? 1,1,1,1,3,1
??.??????.?#? 2,1,3,1
??##?.??#? 4,3
?#?.???#?????# 2,4,1,1
#?#??.??##?#?#?#???? 3,13
??????##??? 1,4
??#????????#??. 7,1
?????##???. 1,2,1
.??..???????## 1,1,7
??#?#?.#??.? 1,1,1,1
?.???????? 3,1
??.??.#?#?#?###? 2,1,9
???.?????? 3,1,1
?#?#?#???.?#?.??#. 6,2,2,3
?.??.#.??????? 1,1,3,1
??#???..??#?.?#. 1,3,1,1,2
??#?#???##?#?#??. 2,6,1,1,1
???????#??.??. 1,2
##??????????#?.????# 9,2,1,2
#?#.#.????#???. 1,1,1,3,1
?#????.???? 3,1
??#??#?????#.??????? 9,1,2,3
#?.?#???#?##???.#.? 1,10,1,1
?..??.?????#??#?. 1,7
?.?#????#?.? 2,4
.?#????.???? 2,1,1,2
??#??.?#???.#?# 3,1,4,3
??.?.??#???? 2,5
??..###.?????#.? 1,3,1,1,1
..??????#??? 1,7
?.?#???#.???# 1,5,4
.??.?.#?#???#? 1,5,1
?#?#??..??#. 1,1,1,3
..??##???????? 7,3
?#??#???#.??.?????#. 9,2,2,1
?.??????..???#??# 1,1,3,7
#?#??.?#?#?#??. 5,5
??.?.?#.??#? 2,1,2
???.????????#? 1,1,1,3
?.#.?#??#?#???. 1,1,7,2
.??#.#?#???#???. 3,5,2,1
???.?#??#???? 2,6
???##???#?????. 1,7,1,1
??????#??#?###?..??? 1,11
???????#.? 1,4
.?????.??. 1,1,1
?#???.?..??##?#?.? 1,1,1,7
????.??#??.? 1,1,4
#..?.??.??? 1,1,3
.?#????..??#?? 6,3
??.??????#?? 1,5
????#???.? 1,6
#???#???#. 1,3,1
.??????.???##?. 2,6
??#?????????.?? 1,2,2,2,1
?.????.??.##??? 2,3
???#???.???.?.#. 5,1,1,1,1
??#??#???.#? 6,1
?..#.??###?#???? 1,9
..??.?#??.????#? 2,1,1,3,1
.???#?##?????? 1,6,2
.#????.??? 1,3
???#????#???. 2,6
??#???#????#?..?#?#? 2,3,4,3
.??.?????#?????###?# 1,1,1,3,6
?.??#?..????? 3,4
??#..???.? 2,1
?###???#???#? 5,4,1
.?##?##?.?###. 6,3
?????.#????. 1,1,1,5
..???????#.???#. 1,3,1,2
???#?..??#????.???? 1,3,6,1
.#?????#?? 1,5
?????.????#?? 2,1,1,3
???.???.??#?#?? 2,1,1,6
??????#???.#?????# 2,3,2,1,3,1
??#?#?#?????#?.# 1,1,8,1
???###??.#?? 1,4,1,1
?#???..?..?.? 5,1
??.?.???#?#. 1,1,3,1
.##??#?#?.????# 2,5,3
#.??#?.??## 1,3,4
..??..?.??.#.?#??#? 2,1,2,1,4
.?#??#?#?#?? 2,6,1
.?##.?.?#? 3,1
?????#?..#??.##? 7,1,1,2
?????..?????#???? 3,3,2
.????.??#?? 3,2
????.?.????? 1,1,1,1
?#.???.?#?.??.#? 2,1,3,1,1
.#????##???# 2,4,1
????#.?.?#?#? 1,1,5
??????????# 4,1,2
.?.?#????#?#??. 1,6,2
???#???#???# 1,3,1
#??#??#??? 2,4,1
???.?##?#?.?..??.. 1,1,2,1,1,2
.?.#??##?##? 1,2,6
??#.?.?#???#.?# 1,1,5,2
.??..????#??#??.??? 2,3,1,2,3
?.#????#???.. 1,5
?#?##??..?????#. 5,1,3,1
??????.?#??#???. 4,1,7
????##??.##??#?##?? 3,9
?#??.??????? 3,1
?.?????#?#???? 5,3
?..???.#??? 2,3
????#???#.??#?# 1,5,2,1
?###??#???#??.?#??? 12,2
??#??#????????#?. 5,7
????#.##???? 1,1,2,1
...???????????#??.? 2,1,4
??????????##??? 1,11
#..???.?#? 1,1,2
?#?????#?????? 4,2,2,1
??????.###???? 1,3,4,1
.?.?????#??#?. 1,5,2
???.??.?.. 1,1
???????#..??#?#?? 2,2,1,5,1
.#????#??? 1,1,1
.???.????#??? 1,3
.???????#??? 1,6,1
.?.?????#??#? 2,3,1
???????????.?.?# 9,1
#????..?..#?#?# 4,1,1,3
??#?.?#?#?#??#?????? 1,13
??#.?.????#?# 1,2,1,1
#???.????##??. 2,1,1,4
.####?????#.???##??? 10,2,3
..??.???.? 1,1,1
???????.#??#? 5,1,2,1
..?##??#?? 3,1
??????.?..##?####?.? 4,8
#??.??????#???#????. 3,2,1,1,3,2
#??#?#????.???. 1,3,1,1,3
.???.??.??#. 3,2
#??#?#?#.??.?????.? 6,1,1,1,1,1
.???#??.?#? 4,2
?#.??##????.# 1,6,1,1
.???####????.?.????? 11,3
.?.?#??..???##???#. 1,3,8
?????.??????#?.?# 2,7,2
??.#.#????#? 1,1,6
..??.#??????? 1,2,1,1
??.??#??#?. 2,1,3
.??????.?.? 2,1,1
????##?????? 1,3,2
???##.?#?#??#?#.?.? 2,2,3,1,1
???.?#?..? 1,2,1
#??????#?#???.?? 1,1,2,2,1
.##..??.#???.#? 2,1,4,1
.????????#??#?#???? 6,8
???#????#??? 1,3,1
?#???#????? 5,2
???#.??????????##? 4,4,6
?##??.???#.??#? 4,1,3
????????#?.#???.. 6,4
????#.?.???#?####? 5,1,1,7
????????#??#??#?. 1,9
??.????????#??.????? 2,1,6,2,1
???.????????????#.? 2,1,4
???#??#???#.?#??##.? 7,1,1,2,2,1
.?#.??##.??.??? 1,3,1,1,1
?.?#.?#?.?.#? 2,1,1,1
????#????#???.??.? 1,3,6,1
##.??##.?? 2,3
?????.???#. 2,1,3
??...#.?????##?? 2,1,9
????.?.?#. 3,1,1
??.#??#?#?.?? 1,6,1
???##??#?#???? 3,7
???#????#?#? 2,4,3
??????.?#?#?.?? 4,5
??##?#?????#. 6,2
.???###?????#?#??? 12,4
#.???.?????.?#?.? 1,1,1,2,3
??#???????????#? 6,1,1,1
.???#???#?##???. 2,9
..#????###??..#??# 1,1,5,2,1
#?????#??#?##????..? 5,11,1
.???????.?. 1,1,1
??...???????????? 4,1
#??##??#??.?##? 8,1,3
?..??.??????.? 1,1,6
.??#?.?#???? 1,2,1,2
??????.????? 1,1,1
?#???###?.#. 2,5,1
#???.#??#?.##???? 1,1,5,3,1
?###??##???.??#????? 9,5,1
?##.??##?.?. 3,3,1
?.???.#??????##.?#? 1,1,1,9,1
..?#.?.????##?? 2,3,2
?#?.?##.???? 1,2,1,1
.#?????#?##### 1,1,9
??#..???#?#????????? 1,6
#.??????##??#?#.??#? 1,5,7,1,1
.?.?#????#???????? 1,3,2,1,3
.#???.????# 4,1,2
#???##??#????. 6,1,1
?.???????.???? 6,1
??#?#??#?..??????. 4,3,2,3
???#?.??.? 5,1,1
??.?#????? 1,1,1
??????????#??.?.?# 1,1,1,6,1,1
.??#?#???#??# 1,1,2,5
?#??##.??????? 5,6
??.??.?????#?#????? 1,1,10
..?????#.?.?..???? 6,2
?##??#.???.#?#???? 6,2,3,2
#?#?#?..??? 3,2,1
.#?#?##???.## 7,2
#???..???#?#?????# 4,1,9
?.?#????##?.???? 9,1,1
.????????? 2,2
#????????????. 1,2,2,1
??.???#.#?? 1,2,2
?????????? 1,1,3
.?.?????#?? 1,2
??#???.???#?##??#? 5,1,6,1
.#???.???? 4,1,1
.#??###???.????##??? 7,5
#???#??#????.?. 1,4,1
???##?##??????#?? 1,6,6
???#?????#????#? 5,9
.?.?..?.???.#???. 1,3
??#?.???.????? 2,3
.#?.##??#.?? 2,2,2,1
#.??????????.?.? 1,4,2,1,1
?.?####??????#.??? 11,1
.????.????? 1,2,1
??#.?????##?##? 2,7,2
?.??????????#?# 1,1,2,1,3
????#.?#?###. 1,6
???????#????#?? 1,1,4,2
.?#?#?#?????#. 9,2
?.????#??.? 4,1
?#?????.???#???.??? 1,2,1,3,1,3
?#???????#?.#.????? 1,7,1,1,3
.#??.???.??#??????# 3,3,9
#????..???#..#? 5,3,2
?.?.#?????.?? 1,6,1
.??..#??#?. 1,1,3
??###???#????##??? 10,3
??#??#?#?#?..??#???? 9,4
???#???????#? 4,6
?.#.?##?.??????##?? 1,4,6
??#???.?#??#? 2,1,6
??????##??.????? 8,1,1
?????#..?. 5,1
##.???.?...?? 2,1,1,1
????????##?#?# 1,7,1,1
??????????????? 8,1,1
???.??###? 1,1,5
????????????????##.? 1,4,1,3,3,1
??????????#?#? 1,3,4
.????.?.???#.???#?.? 4,1,4,2,2,1
.??#?#??#. 1,3,1
??.##.???#?#?.?#. 1,2,2,1,2
???#????#???.???#?? 4,2,1,3
.???.#?????..?? 1,6,1
..#?#????.. 1,2,1
??#?.?##?##? 4,5
?#?.?.???? 2,1
???????.#??#??#? 1,1,3,1,5
??.?.#.?????#??? 1,1,1,4
??#?.?#?????#?.??? 2,4,1,2
??????.??##?#??#?. 2,10
?????????#? 2,1,4
..??#????? 3,2
?????????###?? 1,7
#.?????????..????## 1,3,1,1,1,4
???#??.#.?.??? 1,3,1,1
??????#?#.#???#? 8,1,1
?#??????#? 1,3
.???.?.????##??#? 2,7
?#??#?????.?# 1,2,1,1
???#.#???#??.?##?.? 1,7,3
.?#?.#?.#?? 3,1,1
##?##????????? 7,1,1
..?#?###?????? 2,3,1,2
???.??..????..#?#?? 2,1,4,5
.?.?????????? 4,1
.????#?#?.?. 1,3
??#?##???.#??..? 7,2
????#????? 1,6
.#??????##??#?.?#?. 1,10,2
?#??#?.??#???.???#? 5,3,4
.????????#?????. 10,3
??#???#??#?.? 6,1
??.????#????#??? 1,1,4,1,1
??.?.???##.? 1,5,1
??.###????#??## 8,2
???#???????.?????.? 9,1,1,1
.????#??#??#???## 4,1,6
????..##?.?.?..???? 1,1,3,1,3
?.??.?#?#.?#?##??#?? 1,2,4,6,1
.????#???..????# 1,4,1,3
?##?.?.???#?#???.? 2,6,1,1
.??.??#???? 1,3
?#?.?????#????##??? 1,11
?#??##?#????? 1,5,3
.#?#.#.#.??#?#?? 1,1,1,1,7
#?#???#?###?##??#? 3,9,2
???.????##???????? 1,1,7,1
.?###?????.???##?#? 6,7
.#?#.#???#?????##?# 1,1,1,5,1,4
?????????#?#?#??? 1,2,4,1,3
?.???.#?#??? 1,3,1
#?#??#??.#.#???.. 6,1,4
?#????##?#????.? 10,2
????#????? 1,3,1
??.???.?.. 2,1
?.#???#???????? 2,2,2,2
?.?#??????#?. 1,7
.?????.??? 2,2
?#??.??#?? 2,3
?????#???.??.?..??. 1,1
??..???##???.?. 1,7,1
??#?????#. 1,1,4
#.?#.?##.#????? 1,2,2,2,1
??#??#?##.???# 6,2,1,1
??#??????##. 6,2
.#???.##.?. 1,1,2
??.?????#?.??#??#??? 2,1,2,7
?.??#.??.?.?.??.?. 3,1
??#??#.?#.#? 2,2,1,1
?#?????#?.? 3,3,1
??.#?.??#??.#??. 2,1,3
.???#?#??##.? 5,2
..???#????###?#??#? 4,1,3,1,1
?.???#?.????.?????. 4,2
.#??#?????# 1,1,2
.???#????#?? 1,8
#????????.####? 1,1,1,1,4
??##??????????? 9,2
?.??#?#????? 4,2
?..?????.?.#??? 3,1,3
#??.?#???. 2,1,1
?.#??????????? 1,7,1,1
?.???.?#?#? 2,5
???.?#???#??#??? 1,2,8
???#??#?.?#???? 1,1,3,1,1
???.?#?.?????#????## 3,2,2,4,2
##.???.?#??? 2,1,1,3
?.????.?.??.? 3,2
.??.?.?##????.???? 1,6,3
???.?#???? 2,3
?.???????. 1,2,1
.#???????#.???????. 3,2,5
..??.???#?..???#???. 2,2
???.??.#???##?#?? 1,2,1,6
?#?????#?? 2,3
??..??#??##?.?# 2,8,1
????????##??#??.??#? 13,1
???###.?##.??? 5,3,2
??#..??.????.#?. 3,1,4,2
?.?#?.??#? 1,2,4
?#???#?#?.# 8,1
?#?.??.???? 3,1,3
??##????#?? 3,1,2
?????????##??????? 1,12,2
??#??##??????##??#?. 8,7
??.??.???.? 2,1
???..#???????? 1,6
??.???##?? 1,5,1
#?.???.?#.?#???.#?? 1,2,1,1,1,3
??#????.?##?#???#?. 5,9
...#.???????? 1,5
?.?????????#?#????? 1,1,3,6,1
##?.#??.????.??# 2,3,3,3
??##????..??? 7,1
.??#.?.???.?.?#?..?? 3,1
??#????##??.? 1,5
#?????#.?#????.??? 1,4,1,2,1
#??..???.??.#??#? 3,2,1,4
.?#??#?..#?.#? 6,1,1
???##?#?#?.?# 3,4,1
???.#.?..??.#.???# 3,1,1,1,1,2
?.?.#.????? 1,1,2
???.??????#?# 1,2,5
????????.?????.?# 1,2,4,2
???????????#??? 8,1
?..#?.????#???##?# 1,1,10,1
..####??..?? 5,1
???#?###?#?.???? 9,1,1
.??.?????????..? 1,1,6
.?##?.?#.? 2,1
#??#??.??#..?.??.?? 6,2,2,1
??#??#?.?? 5,1
..#####?#???????? 8,4
?????#?#??.???# 6,1,2
?#?#????####????##. 5,1,10
??.??..?##??? 2,3
?.?###...?#?#. 3,3
?????????? 4,1
##.?.?#.??#? 2,2,1,2
??????#.??.#? 6,1
.?#???.??#?? 4,4
????#???#?#?#??#???. 5,12
?#..?.#???.??. 2,4,2
#.??#?#??.?#?#??#. 1,4,1,4,1
#.?..?.?#.?????????# 1,1,1,1,10
?##??##????###???? 3,2,1,5
?#??.#?????.???#?.?? 2,3,5
?.??.????? 2,1
??????##???.?? 2,2,1
??.#???#??#??.??##.? 2,3,5,3,1
?#?##????????? 5,1,1
???##??##???##???.? 14,1
??#.??????..## 2,1,1,2
.?#???.??? 2,3
.#????.???#.??#???. 3,3,5
???.?#?#??#??..??? 1,9,2
???#???????#???#??? 1,4,4,1,2
.?.?????????????#?.? 1,15
??#?#?.?????..? 3,1,3
???.??#?#?# 1,7
.??#??.???#.. 4,1,1
.??????.#????.????. 3,4,2
??#.##.#.?.#??.??##. 2,2,1,1,1,3
#.?.?..????? 1,1,1,2
???.##?.#.?##???#??? 1,3,1,4,2
##.??##??#. 2,3,1
..???#???????.??.? 8,1
#?.??.?????? 1,1,1,1
?###.?..??.#???#? 3,1,1,1,2
?#??????.?? 4,1,1
??.???.?.? 1,1
????????#???????.# 9,1,1,1
???.?#?#?#??? 2,7
#..??.?.?? 1,1,1
.??#????##??.????#? 9,5
??????.???#?? 1,2,1,1
..???..??#??#?#?? 1,9
????.#..##??#? 3,1,6
???????.... 2,1
##.???..?? 2,2,1
##??#???#????????#?. 5,4,5
.??..??#????? 1,1,2,1
.?????.##??? 3,3
?????#??#?##? 3,1,5
.#????.??.??.?????. 1,2,1,2,1,1
???.?.?#????..?##??? 1,1,1,1,3,6
???##?#?????#? 1,2,4,1
???##???????##??? 1,5,8
?#???????##????## 5,1,8
??.#?.?#?? 1,1
?????????????? 1,3,1,4
?#.???#??#?##???# 1,1,1,8
???.????##?. 1,1,1,5
?##..#???.??#. 3,3,1,1
?#?##?.?????.??## 5,1,4
?.???????.?. 1,1
.?.??.??## 1,1,2
??#?????.?# 5,1
?.?#.??????##.?#? 1,1,8,1
?#???.?.???? 4,1
???#?#??##??.?? 1,7,1
???..#????#??#?? 1,10
???????#???????##.# 2,1,2,1,6,1
?.?#??#.???? 1,1,2,1
..??##?.#???#??#??? 1,2,2,3,1,1
???????#?.##?# 8,2,1
?????..??? 2,1,1
#??.#.??#?# 1,1,3
??#?#?#???#.? 6,1
??#????##????? 4,5,2
???#??#??#.?#?##??? 2,7,5,1
.????#???? 4,1
.####?##?#??.#? 9,1
?????.?#?####? 2,8
?.?????#??#???#??? 1,1,1,1,6,1
?#?????#?#????? 3,3,1,3
##??#..?#?.???. 5,2,3
??##?????? 1,4,2
#?.???.?#?#? 1,1,1,1
#.??????????#????#?? 1,2,8
?#?#???#?? 3,1
??#?##??????#.???. 11,1
??..##???? 1,2,1
????#??#?????#???? 2,1,9,1
#???#???.???#??? 1,2,1,1,3
?#??????#.???? 6,1,2
???????????? 1,1,1,2
???.??????.??? 1,1,1,2
?.#???.???##.?.? 3,5
#?????#?##?#??#????# 13,2,2
?.??????.??#? 1,1,2,1
.??.???#??##?#? 1,1,1,6
???????????. 6,1
.????.????#.. 3,4
?.?#?????#?? 4,2
?#?#???????#?#?????? 10,1,1,2,1
???????????? 1,1,5
?????????# 1,5
..?#?###.##.??# 6,2,2
??#????##?#???? 2,3,3
#?#?????.??#?#? 1,2,6
.#??.#.???????.?..?? 1,1,1,7,1,1
????#??##??#?#?#?# 3,1,5,1,1,1
??..???####???????? 1,7,1,1,1
???...#.?? 2,1,1
.?.??#?..#???#?.??#? 3,6,2
?#??????#?? 5,1
?#??..????#?#???? 3,7,1
??.???#?.? 1,2,1
???#??.???#??? 3,1,2
???##???????#?. 1,3,1,3
???#?????#?..#?#? 1,5,3,3
??.?.?#?#??##?#? 1,1,4,4
.###???????#?# 3,8
.#??.?.???#?# 3,1,4
#?.???.???#. 2,1,2
##??#?.??. 2,2,2
#...???#?##?..#? 1,1,1,3,1
?..?#?#?#?.?????? 6,4
#?#????#????#.?.??? 1,9,1,1,2
#..??#.?????#???##? 1,3,3,7
.????.???#??###?? 1,8
?##?#????#? 3,2,2
????.??..#? 1,1
?.????###????? 1,6
??#?#.???#?#?? 4,3
?##?#??#?..???.#?. 8,2,2
?.#????#????#?.#???# 1,2,3,4,2,1
?#?.#????. 2,3
.??##??###???# 10,1
??#??##???...?? 6,1,1
#?????.?..#.? 5,1,1
?????#??????. 2,4,3
????#????? 1,1,2
?.?#???##? 1,1,5
#????.?.?????? 4,1,4
.??????????? 1,3,2
?.??????#??? 1,4,1
?.?#?????? 1,3,1
?.??.###???##????#?. 1,1,3,7
?#??????#.#. 2,1,1,1
.?##?.?????##??## 3,10
????.???#?? 1,2,1
??#????.?#?? 6,2
??.?.#?????.#.?? 2,1
?.??.?#?#?? 2,1,1
?##?.???#? 4,3
?#??.???#?.?? 2,1,4,1
.???????????.# 1,3,4,1
?#???.??#?????.? 1,2,1,6
??#?#?#??.#??. 2,4,1,1
??.?.??#???#?.??.?.? 1,1,6,2,1
#.#?.#???#?#?????#? 1,1,14
.???.#???#??? 2,2,3
##????????#??.?#..? 2,2,2,1,1
?#???#?..?. 1,2,1
??#???#?????#???.?? 3,5,4,1
#??????????#?#?? 1,3,7
?#???#??#?#?? 6,5
??????????? 1,6
#?????????????#? 1,2,6,2
????#??.#.??#. 1,2,1,3
?#????###?.?#.#??. 4,3,2,2
#????#??##????? 1,1,8,1
????.???????#?#? 4,8
?????#??#???#?.?? 6,3,3,1
?????.???..?#.??? 1,1,3,2,1
.?#??#?..???# 4,3
???...###?. 1,4
?#?.?????? 2,3
#?..?????. 2,1,1
????##???? 1,4,2
????????##???#?? 1,1,1,8
??.?..?##?.?#?##?.? 2,1,4,2,3,1
????.???.? 1,2
???????###? 2,5
???.#?.#.?##?? 1,1,1,5
?#????#???.?.? 9,1,1
????.??????##? 1,1,4
.???##.???..#? 5,3,1
?#?##?#?###????????? 5,1,7,1
#..#?.?#????##. 1,1,1,1,3
?.???#???????#???# 4,4,2,3
??.?.??###???????? 1,11
????#?????.??? 2,2,3,1
.?????????####...? 3,6
##??#?##??..??# 10,2
????#?#??.#??? 8,3
#.?????.??#?##?#? 1,1,1,8
#?.??####????.???#? 2,6,1,3
?#?????#.??? 3,2,2
???.##?#.?????????? 3,2,1,1,2,4
??##?##?????..??? 10,1
??.???????#??????? 4,8
###?.???#??? 4,1,2
##????#??#. 4,2,1
.?#?#???.??###?#??# 4,2,1,3,1,1
??????.?..#?.??# 2,2,2,3
.???????#?. 2,5
#?#??????? 4,2,1
.#?.???#??#??????#.? 2,11,1,1
??.????..##??..?### 1,3,2,1,4
???.?????#??? 1,6,1
???.?#??#? 1,4
#??.?????#?. 3,6
??#.#??.??????###? 1,3,8
.???.#????.??? 1,1,5,2
.#??????????? 1,2,2,4
#..?#??#??? 1,8
????#????? 1,1,5
?.???.?????.?????#? 2,4,7
#.?..?##??..??#??? 1,1,4,1,1,1
.???????#????. 2,8
###?..#.??????.?? 4,1,1,1,2
???.??.?### 1,4
???#.?#??.???. 2,4,2
.?#????#?.#???? 1,4,1,1,1
?.??##??#??? 4,5
##????#?#?. 2,4,1
.???#?#??#??#?.#?#? 10,4
.?#?#???.?#.??# 2,1,1,1,1
??.?????#..#??.??? 1,3,1,1,1,1
?...#?#?????????.. 4,3
.?#??????#???#?##.?? 11,4,1
?#???##...?.?????.?? 6,1,3
?#?.?#?#?? 2,1,2
?????##??#.????.???? 8,2,1
.???????#????##???.? 7,1,6,1
??##?????# 5,2
??##..#.?. 4,1,1
????##???? 1,2,2
???#????#?##???#??? 12,1,1
.???????#??.??? 8,3
?#?.##????? 1,7
??????.?.?# 4,2
??#???.#?#?#??? 1,1,1,3,1
???#???#?#???. 1,1,4,1
.???#?????#?..#???.# 4,5,1,1,1
???.??.#???#?. 1,2,1
..????.??##?? 1,6
??#?.?.?#??.??#. 1,1,1,2,3
#????.?#????#???#?. 1,1,1,4,1,1
????????????. 6,1
??.??#??#????.????# 2,7,5
#???????###.?.????. 1,1,6,3
???#?#???#?###? 6,7
????.#?#.??#?.???.? 1,1,3,3,2
#?????.???#???? 5,5
#??#??.#.?????#?. 1,2,1,7
?????#???. 5,2
????????##???.??.? 2,6,1
#?????????? 3,2
.??#????..??????#?? 2,1,7
????????#?##?? 9,2
#?.??????.??? 1,3,1,2
?????.????#?.?? 2,1,1,2,1
#???.??#???? 1,1,3,1
????.??#?. 4,1
???????#.???????? 6,5,1
??.???#??#??????. 1,7,3
???#??##??#????????? 1,13
.#?????????.#???.? 6,1,1,2,1
?????????.. 2,1
??????#????? 1,2,2
#?#????..????#?? 1,4,1,2
?.?.?#????#. 1,1,2,3
#??###??.?#????#???? 8,8
.#.?#????# 1,1,4
?#???#????? 1,6
????.?#???#.?. 2,2,3,1
??.?#?#????? 2,1,3
##???.??.?##????. 2,1,2,4,1
?????#?..?#?#?. 5,3
??#????#????. 10,1
????????????#.?? 1,2,6,1,1
#.?#??.???? 1,2,4
#..???#??? 1,4,1
?????#????#? 4,2
???.##???.. 1,3
?.##?#.?????.?. 4,3,1
??##??.?.??# 4,1,3
?#???#.?.??#??.??. 2,3,1,1,2,1
#??##????#???. 10,1
.??###?#???#?##?.#.? 14,1
?###???????????? 3,1,1,1,2
#?.???????.???#? 2,1,4,4
?#???#???? 1,3,1
????#?#????# 1,5,1
???###????????? 9,1
??????????#????????. 2,10,2
?#.??##???.?? 2,3,2
#?.???.??##? 1,1,1,4
???#???####???????# 11,1,1
##?.#??.?????.?#??#? 3,2,5,1,2
#?.??????###.?#?# 1,9,2,1
??#??##??.#####?. 9,6
?#?.???#?#.?????? 3,5,1,1,1
???##.#???####?.?? 3,9
????.?.###??.?#?? 2,1,3,1,4
.?#??.?####.# 4,5,1
.????.?????#?? 1,3,1
?.##????.???#? 3,1,4
????.###?????.? 2,4,3,1
?.?#.?#?????#??? 1,1,8,1
?#?????????.????? 2,5,2
..#????#?#?..#?????# 1,7,2,2
#????..???#??# 1,1,7
???.??.?#?.?? 3,1,2,1
?#??#?#??##?#??#?. 3,1,11
????#?#?###? 1,8
?#????.???#.? 4,1,1
.?#??????????. 1,2,5
.??#??#??. 2,2
???###?????#???#??#. 7,2,4
??.???.?.????? 2,2
???#??#??# 1,7
???#?.??.????#?##??. 4,2,10
#??.??#??????#???# 2,1,8
????#?????#????#? 1,5,1,4
?.#?##??????? 1,5,1,1
#??.?#??????? 1,6,1
?..?##??######??.?? 1,11,1
??#??#.?#?#???????? 1,4,2,1,2,3
??????????##???.. 2,4
.???????#.#? 1,1,2,2
???????#??##.? 1,1,1,5
???.??#??? 1,5
.#?#.?#?#?# 3,4,1
.?#?.??.?#???? 2,1,2
.?.#?#????#???? 3,3,1
#?????????#..##?#? 1,2,1,1,4
??##??????.?? 4,1,1
.??????#?#? 3,4
?#.?.?..?#?. 2,2
?#??.?#?#??.??????# 2,2,2,1,1,2
?##???##??????..# 8,5,1
??.?#?????????#?? 2,1,9
????.???.. 1,1,1
???#?.???? 3,1
??.??????#???????? 2,6
??#???##???.#?#?. 3,5,4
##???????? 3,2,2
.??#????#?? 2,4
??????.??# 2,2,2
##..#??..??#???. 2,2,6
..?.#?#??.???????? 3,6
##??????#??????? 2,1,1,6
???#??..???? 4,2
.?#?#??..?????.?? 4,3
#??#????.#?? 8,1
.???##.??.?? 4,1
??????#??##?????? 2,13
##???..?.?? 5,1
?.?#?#???..##? 1,6,3
??.????#.?#??# 1,4,1,1
.#?????????#??.??#?. 5,5,2
??.?..#.#??? 1,1,2
??#?.?#??###??? 4,8
??#??#?##???. 2,8
#.#????#???? 1,1,1,1
#???##?#??#??#????? 2,8,1,4
?????????#??## 1,10
??#???#???#??????. 1,15
?###??.??????## 5,3,4
?#???#?.?? 6,1
?.????.???#?###???? 1,8
?##??????..???? 3,1
??##??#..?#?. 5,1
.###?????#?? 6,2,1
??.#??.#?#. 2,1,1
.??.?##???##.#???# 1,8,2,1
?#?#????.##????? 4,3,2,1
?????????.??.? 3,1
##?.???????#???#? 2,10
??#..#???#???#?. 1,1,7
?.#?#..?##?..?? 3,3
??#???????#??#. 1,1,7
#..?.#???#??# 1,1,2,5
.????##???. 1,6
???#???.???#???? 4,5
??##????#. 3,1
??.?#.??.?. 1,1,1
.??.????#??? 1,1,1,1
?.###?.????.? 4,2
???##????.?.?.?.?##? 4,1,1,1,4
???##?#??#?#.# 1,5,3,1
?.?????#?????? 1,1,4,1
..#??##?#?.?#?.? 7,3
#..??#????????????? 1,3,2,4,1
?#.?#??.#?#?????? 1,4,5,1
#???????##..#????? 10,6
..???.#??? 2,2
??#??.?.#??. 2,2
?.?#??.?.?#..?? 3,2
???#?????? 3,3
????????.????..?# 3,2,1,1,1
?????????#?.# 1,1,4,1
#?#.?..?#?.?. 3,2
???.??##????????. 2,9
??#.#.????#.??? 2,1,1,2,2
????.?#.??? 1,2,1
#???????.???.?. 1,1,2,2,1
???.????##????? 2,3,1
?????..??#? 1,2,2
.#?.?#???? 2,1,2
#?????????? 5,2,1
???#?#?..?#????#??.. 6,9
.#???.?????#????. 1,2,4,5
????.??.#???? 2,1,1,1
#?.???##??? 2,1,2
??.?###??.????#?.??? 1,6,4,1,1
#?..?#?##?.? 2,5,1
?????.#????.???# 1,1,4,1,2
#?#??#????#????# 3,2,2,4
???.?????####.##?.? 2,3,5,3
??????..#.? 1,2,1
#????.#???.#?##?? 2,2,5
.??.?#?###?????#??? 1,13
?.??#.??????#?? 3,7
#???.#.????#?.#?#??? 1,1,1,4,3,2
????.#????. 3,1,1
?.???????#??#??.?? 1,4,3,1
#?.#???..??? 2,1,1,2
.?#?#????.? 2,5
??##??#??# 7,1
????##.??##?? 1,2,3
???????????#??? 1,3,2,1,1
??????##?..#?#??.?.? 9,1,1,1,1,1
.???.???.?? 1,1
#?.??.?#???????..? 1,1,1,4,1,1
?.?#?#?.???#?. 5,3
?????????.??..#?.? 5,2,1,1
?#???.???##?????? 3,10
?##??.#?????#.??#? 4,4,2,1,2
.#.?.??.?? 1,1,1
???#?.???.?.???? 2,3,2
?#.?#??.?? 1,1,1
#??##.?.?#?#?????# 1,2,10
?.????###????.? 8,1
?##???????? 4,4
??.?.#?.?#?.###???#? 2,1,2,1,8
?##?#??????.?.??#?# 6,3,1,1,3
?.?.#??##???#?#? 1,1,5,1,1
????.???#?#???#? 3,6,1
..#??###??????### 6,7
.???????.??#. 1,1
?#????????#???#??? 2,2,4,2
.#??#?#?????. 1,2,2,2
??..?.?????##????. 2,1,3,2,1,1
??.?#.?.#?? 1,1,2
?????????? 7,1
#??????.?..??????? 6,1,1,1,1
??.#???#?????.?????? 1,8,1,1,1
.#.#????????. 1,1,5
???#?#..##??## 4,1,3,2
.#???#????????.# 1,9,1,1
?##???????? 3,1
??#????#.#? 1,1,1
.??###.?#???#??#???? 5,3,6
.???#?#???####??#?? 7,8
???.?.??????????? 1,10
#.??.?.#?..# 1,2,1,1
????#.??#... 4,2
#?????..??.? 1,1,1,1
#?????##???.? 1,1,3,1
????????.??? 1,1,1,3
.??####?.?#??#??? 4,5
?#?#???..? 1,2,1
??#???????###??. 5,7
?.?#?#?##?.?#?##. 7,4
###.##????#???.?# 3,2,2,1,2
..??#?..?#??.##?#?## 1,1,3,2,1,2
?#????????????##???? 1,1,3,1,6,2
???.?#??.??? 1,3,1
???##???????.??##?? 4,1,2,4
.?.?.?#??## 1,5
?.##??????.???.? 6,1,2
.?????.?###? 1,5
????.?????. 2,1,1
#?????.?????.#??.?#? 1,1,1,1,2,3
????????.#?.. 6,2
?.#???.????.?.??#? 1,1,2,1,1,2
?#????#?#????#?..?. 14,1
#..??#?#???? 1,1,6
?.?#?#?????? 4,1
????##?#?.#?. 5,1
?????###??.#?#??.? 1,7,5
#??????.???? 1,1,1,3
??#????????. 1,5
...#??#..????. 4,1,2
?#??#??#?.? 5,2,1
??#??.?#??????????. 3,6,3
?.#?#?????? 5,2
???#???##?.??. 8,2
..?.#??????.? 1,1,1
???#.##??#? 3,5
?.????#???????.#? 1,1,4,1,1
?#?????.??? 2,2,2
?.?#?.?????.?. 1,1,1,2
?????.??????.??????? 3,2,1,1,1,2
#?????#??..#??#??. 9,5
..#?????.. 1,1,1
?..???#??#?????#?#?? 5,4
##??????##????.?? 13,1
????##???#????. 1,6,1
???.#?#??????# 1,4,2
.???.??### 2,3
?.#??????####?#??? 1,1,1,1,7,1
?.?#.?.?????##.? 2,1,1,3
??#??.###?? 4,3
..????#???????? 2,7
.??????????. 2,1,1,1
?#.???#?#????? 2,1,4,2
#?##???.?#.?.#. 5,1,2,1,1
#.?#.?#?#? 1,1,4
??.???##?. 1,1,3
????#.???#?## 2,1,2,4
???#?#?#??##??#??#? 1,15
#?.????#?????.????#? 2,1,6,1,2
.?????.#??? 1,1,4
#?.???###?#???. 1,1,8
?.??#?#????????# 1,5,1,1,2
.????.???##?#.??#?? 1,1,7,3
.####.#??# 4,1,2
?#?????.#.?.?## 2,1,1,1,3
??#?.??????# 1,1,2,3
????.#??????? 4,5
#..???.?.???##.??? 1,3,1,1,2,1
.?#??..?.?##?????#? 4,1,2,2,1
??#.??.?.??# 2,1,1,1
#???#???????? 9,2
.?#.????#???? 1,2,2
#.??.?#.???.??? 1,1,1,2,1
?????##????.?.?? 10,1,1
?????#?.#???.?????? 6,1,1,1,1
?#???????. 1,1,1
????#??????##???.? 2,1,2,2,1,1
???.?##??????#???.? 3,3,7
?.#?.???.#?? 2,1
?..??#????.?.?..##?? 7,3
?#?#?#?????????# 4,1,3,2,1
?.#.#?.?????? 1,1,1,2
#??.?##??..?????.? 3,4,2,1
????.#????##??..?#? 3,1,3,1,2
??#?..???#?? 3,1,1
???..?#???### 3,1,1,3
.??????..???## 5,3
##??????.???? 4,1
?#????##?#?.???? 1,5,3
..?##?#??????##.??#? 9,2,1
..#??.?.??. 1,1
.???.?#???????#??? 1,5,1,1,1
.???.??#?? 3,3
??#?##??#?.?#? 10,2
?.???.???.?? 1,1,2,1
????.????# 2,2,1
??????.?????? 2,3,1
??.?#..#?#??.?# 2,1,5,1
?????#?.?#???..???? 2,3,2,1,1,1
??.??####?##.??. 1,8
?#????##?##.##??? 2,7,5
.#???#..???#?#???#?? 2,1,11
?##??#?.????? 6,2,1
#???.?#??..??? 1,4,2
???????###? 4,3
??.??#??## 1,1,5
?.?#??.?#?#???. 2,6
#??.?????#?##?#??? 1,1,1,1,9
?#??#.??#??####??? 5,9,1
#??.??????. 3,5
#???#??#.??#? 1,6,1
.?.???##??.?#????. 5,3,1
?#?##??????##???#??. 1,10,3
.?????????.?? 1,1,2,1
?.???#???. 3,1
????????#?#?? 5,4
?.?????##.????#????? 1,1,2,1,5
??#???#?#??.. 1,1,5
??##??##?.#...??.?? 4,4,1,1,1
?#??##?##?##?#???. 11,2,1
?..????#???. 1,1,3
????#???????. 3,2
?###.?#??.???#.?#? 4,2,1,1,1,3
?#?#?????.?#?? 7,1,1,1
???????#???. 1,2,1
#?##??#?..?#?.?# 7,2,2
???#.#??.??#?. 3,3,4
.???..##?? 2,3
#.?.?.?..??##?? 1,1,1,5
.?#??#??#? 2,1,1
?#?##??.#??? 2,3,1,1
#???#????.????????#? 6,1,3,4
.#..????????#? 1,1,1,3
????.#??..??.? 1,2
#??#..?#??#????? 4,1,5
#?#????.????#.???. 7,1,1,1,1
.?????????? 1,2,1
????#?.??? 1,3,1\
"""

lines = String.split(input, "\n")

defmodule Counter do
  def count(_chars, groups, _) when length(groups) == 0 do
    0
  end

  def count(chars, groups, _) when length(chars) == 0 do
    if length(groups) == 1 && Enum.at(groups, 0) == 0 do
      # IO.inspect("found!!")
      1
    else
      0
    end
  end

  def count(chars, groups, dp) do
    if length(chars) < Enum.sum(groups) do
      # IO.inspect(["chars too short", chars, groups])
      0
    else
      [first_char | rest_chars] = chars
      [first_group | rest_groups] = groups
      # IO.inspect([chars, groups, {first_char, first_group}])
      dpkey = Enum.join(chars ++ groups, ",")
      cache = Agent.get(dp, & &1[dpkey])

      if cache != nil do
        # IO.inspect(["found cache", dpkey, cache])
        cache
      else
        matches =
          case {first_char, first_group} do
            {_, g} when g < 0 ->
              0

            # use #
            {"#", g} when g > 0 ->
              count(rest_chars, [first_group - 1 | rest_groups], dp)

            # expecting .
            {"#", 0} ->
              0

            # use . or skip
            {".", 0} ->
              count(rest_chars, rest_groups, dp) + count(rest_chars, groups, dp)

            # expecting #
            {".", g} when g > 0 ->
              0

            # treat ? as . or skip
            {"?", 0} ->
              count(rest_chars, rest_groups, dp) + count(rest_chars, groups, dp)

            # treat ? as #
            {"?", g} when g > 0 ->
              count(rest_chars, [first_group - 1 | rest_groups], dp)
          end

        # IO.inspect(["set cache", dpkey, matches])
        Agent.update(dp, &Map.put(&1, dpkey, matches))
        matches
      end
    end
  end
end

{_, dp} = Agent.start_link(fn -> %{} end)

ans =
  for line <- lines do
    [folded_record, folded_groups_str] = String.split(line, " ")
    record = List.duplicate(folded_record, 5) |> Enum.intersperse("?") |> Enum.join()

    groups =
      String.split(folded_groups_str, ",")
      |> Enum.map(&String.to_integer/1)
      |> List.duplicate(5)
      |> Enum.reduce(fn i, acc -> acc ++ i end)

    minchars = Enum.sum(groups) + length(groups) - 1
    # IO.inspect([record, groups, minchars])

    for i <- 0..(String.length(record) - 1),
        i <= String.length(record) - minchars do
      record_slice = String.slice(record, i..-1)
      # skip if sliced any #
      if i > 0 && String.slice(record, 0..(i - 1)) |> String.contains?("#") do
        0
      else
        Counter.count(String.split(record_slice, "", trim: true), groups, dp)
      end
    end
    |> Enum.sum()
  end
  |> Enum.sum()

IO.inspect(ans, charlists: :as_list)
# 6555315065024
# took 14s to run
